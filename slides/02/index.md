---
marp: true
paginate: true
theme: press
---

<!-- _class: cover -->

<h1 class="logo"><b>CODE</b>_ARCHITECT #2</h1>
<p class="title">コード・アーキテクト :: アプリ設計・開発手法 #2</p>
<p class="author">&copy; 2025 Satoshi Soma</p>

---

# ローカルでスケッチを動かす

---

まずは前回デスクトップに作成した `📁 HelloP5` にターミナルで移動しよう。

```sh
% cd ~/Desktop/HelloP5
```

この記号 *`~`* は「*ティルダ<small>（またはチルダ）</small>*」と呼び、ターミナルにおいては特別な意味がある。
**`~` で始まるファイルパスは必ず自分のホームディレクトリを基準としたパスとして解釈される**のだ。
つまり、上記のコマンドは以下のコマンドと同じ意味を持つ。<small>（macOS の場合）</small>

```sh
% cd /Users/自分のユーザー名/Desktop/HelloP5
```

<small class="note"><kbd>Tab</kbd> キーでパスの補完が出来ることも忘れずに。</small>

---

次に CODE_ARCHITECT に付属している `📁 files/p5_template` フォルダ内の*全ファイル*を、
`📁 HelloP5` フォルダ内にコピーしてほしい。

ファイルのコピーは *`cp コピー元 コピー先`* というコマンドで行える。 
また、**フォルダ内の全ファイルをまとめてコピー**したい場合は、

```sh
% cp コピー元ディレクトリ/* コピー先ディレクトリ/
```

このように *`*` 記号*を用いる。

---

## ローカルサーバー
スケッチ内で画像や音声素材などのファイルが使用されている場合、
残念ながら **`index.html` を直接ブラウザで開くだけでは正しく動作しない**。

通常、ブラウザでウェブサイトにアクセスする際の URL は `http://` または `https://` で始まるものになる。この部分を「**プロトコル (Protocol)**」と呼ぶのだが、
ローカルの HTML ファイルを直接ブラウザで開く場合は **`file://`** というプロトコルを使用することになる。この `file://` プロトコルにはセキュリティ上の理由で*機能制限*が掛かっており、
*スケッチからローカルにあるファイルを読み込むことができない*のだ。

ローカルでスケッチを正しく動作させるためには `file://` プロトコルを避け、
通常のウェブサイトと同様、`http://` プロトコルを使用しなければならない。
そのために必要になるのが**ローカルサーバー**だ。

---

単に「サーバー」というと大抵はサーバーマシンのことを指すものだが、
ここでは*サーバーソフトウェア*のことだと理解してほしい。

サーバーソフトの役割は、ユーザーからのアクセス要求（**リクエスト**）を受け取り、
その要求に対する適切な情報<small>（HTML ファイルなど）</small>をユーザーに提供 (Serve) することだ。

インターネットに繋がれたリモートマシンがサーバーソフトを稼働させることで、
世のウェブサイトやウェブアプリは機能している。

---

ウェブサイト, ウェブアプリの開発者は、**自分のコンピュータ（ローカルマシン）上でサーバーソフトを稼働**させ、ブラウザで動作確認を行いながら開発を進める。

サーバーソフトは一つでは無いが、
当講義では **[Browsersync<small>（ブラウザシンク）</small>](https://browsersync.io/)** をローカルサーバーとして利用することとする。

---

## NPM
Browsersync のインストールは、前回インストールした Node.js に付属している、
**NPM <small>(Node Package Manager)</small>** を介して行う。

NPM は*パッケージ管理ソフト*の一つで、Homebrew と用途は似ている。
ただし NPM が管理する対象は JavaScript 製のアプリやライブラリが主となる。

NPM でアプリをインストールするには以下のコマンドを実行すればよい。

```sh
% npm i -g アプリ名
```

アプリは [www.npmjs.com](https://www.npmjs.com/) で探すことができる。

---

Browsersync は以下のコマンドでインストールできる。

```sh
% npm i -g browser-sync
```

インストールが成功すれば *`browser-sync`* コマンドが使用可能になる。

実際にローカルサーバーを起動するには、

1. `cd` コマンドで **`index.html` のあるディレクトリ**に移動し、
2. 以下のコマンドを実行する。
```sh
% browser-sync start -sw
```

---

ローカルサーバーが起動すると以下のような情報が表示される。

```sh
[Browsersync] Access URLs:
 ------------------------------------
       Local: http://localhost:3000
    External: http://xxx.xx.xx.x:3000   # 注意: x には実際には特定の数字が入る。
 ------------------------------------
          UI: http://localhost:3001
 UI External: http://xxx.xx.xx.x:3001
 ------------------------------------
[Browsersync] Serving files from: ./
```

`Local:` の右に示されている URL にブラウザでアクセスすれば実際に動作確認を行うことができる。
*`localhost`* というのは、**このサーバーを動かしているマシンそのもの**のことを指す。
`:3000` という数字は*ポート番号*を示しているが、ここでの解説は割愛させていただく。

`External:` の右に示されている URL を使用すれば、他の PC やスマホから動作確認を行うこともできる。ただし、同じネットワーク内のデバイスからのアクセスのみに限られる。

---

注目すべきは URL のプロトコルだ。今度は `file://` ではなく *`http://`* なので、スケッチからの素材ファイルの読み込みも問題なく行うことができる。

このようにローカルサーバーを利用することで、
ウェブサイト, ウェブアプリを*インターネットに公開した際と遜色のない動作*を、
ローカルで**再現**することができるというわけだ。

---

また、Browsersync には **Live Reload<small>（ライブ・リロード）</smalL>** という機能も備わっている。
これはファイルに何らかの変更が加えられた際に、ブラウザ上の表示を*自動で更新する*というものだ。

エディタの横にブラウザを並べればスケッチの編集結果を即座に確認することができるため、
制作効率が格段に上がるだろう。是非とも活用してもらいたい。

---

# 実習: QR コード・ジェネレーターを作ろう！

---

これでウェブアプリ制作に必要な最低限の環境が揃った。
ここからはいよいよ実習に入っていく。

<hr>

最初の第一歩は、比較的作るのが簡単で実用的でもあるウェブアプリとして、
**QR コード生成機<small>（ジェネレーター）</small>** の作成に挑戦してみよう。

---

まずはプロジェクトルートを新たに作成しよう。
CODE_ARCHITECT の `📁 files/p5_template` フォルダをデスクトップにコピーするだけで良い。

フォルダを丸ごとコピーするには:

```sh
% cp -R コピー元 コピー先
```

コピー後のフォルダ名は **`qrgen`** としよう。

```sh
% cd ~/Desktop    # デスクトップに移動
% cp -R code_architect_2025/files/p5_template qrgen    # フォルダのコピー
```

---

コピーしたプロジェクトルートには p5.js のスケッチが動く最低限のファイルが揃っている。
VSCode を起動してファイルの内容を確認しておこう。
またローカルサーバーも起動し、スケッチが稼働するかどうかを確認しよう。

```sh
% cd qrgen                  # プロジェクトルートに移動
% code .                    # VSCode を起動
% browser-sync start -sw    # ローカルサーバー (Browsersync) を起動
```

---

## 要件定義
アプリのコーディングに取り掛かる前に、まずそのアプリに**どのような機能が必要なのか**を考えなければならない。つまり、*アプリが最低限満たしていなければならない要求仕様を明確にしておく*ということだ。この工程を**要件定義**と呼ぶ。

---

### QR コード・ジェネレーターの要件
1. ユーザーが任意の URL を入力できる。
2. 1\. の URL に対応する QR コード<small>（二次元バーコード）</small>を生成し、画像として表示する。

最低限これら二つの要件を満たしていれば「QR コード生成機」と名乗ることができるだろう。

<hr>

次はアプリがこれら要件を満たすための具体的な**仕様**を考え、決めなければならない。

---

1. ユーザーが任意の URL を入力できる。➔ **テキストの入力欄が必要。**
2. 1\. の URL に対応する QR コード<small>（二次元バーコード）</small>を生成し、画像として表示する。
   ➔ URL を QR コードに変換する**外部ライブラリ**を利用する。

<hr>

まずユーザーが任意の URL を入力するためには、当然ながら*入力欄*が必要になる。

そして肝心の QR コードの生成だが、全てを自力で実装するには QR コードという規格の詳細な仕様を理解する必要があり、*非常にハードルが高い*。

だが幸いなことに有志によって開発された、QR コードを扱うことのできる*ライブラリ*が多数存在するため、今回はそのうちの一つを選んで利用させてもらうことにしよう。

<small class="note">ちなみに QR コードを開発したのは日本の自動車部品メーカーのデンソーである。<br>規格・仕様は [www.qrcode.com](https://www.qrcode.com/) で公開されている。</small>

---

QR コードを扱うためのライブラリ:
https://github.com/paulmillr/qr

---

ファイルのダウンロード:
```sh
% curl -LO ファイルのURL
```

---

VSCode で p5.js 関数の自動補完を有効にする:
```js
/// <reference path="https://unpkg.com/@types/p5/global.d.ts" />
```

---

## URL 入力欄を実装する
ページ内に何らかの入力 UI を配置するには、UI の種類に応じた HTML タグを記述する。
今必要なのは、ユーザーが*自由に文字を打ち込むことのできる入力欄*で、
以下の記述で対応できる。

```html
<input type="text">
```

**`<input>`** は*様々な種類の入力 UI* を表示するタグで、*`type` 属性*の値で UI の種類を指定することができる。ちなみに*閉じタグは存在しない*。

---

<!-- _class: small -->

以下に例を示す。<small>（一部のみで全てではない。）</small>

| HTML | 表示 | 種類 |
| :-- | :-- | :-- |
| `<input type="text">` | <input type="text"> | 文字入力欄 |
| `<input type="checkbox">` | <input type="checkbox"> | チェックボックス |
| `<input type="radio">` | <input type="radio"> | ラジオボタン |
| `<input type="color">` | <input type="color"> | 色選択 |
| `<input type="date">` | <input type="date"> | 日付選択 |
| `<input type="password">` | <input type="password"> | パスワード入力欄 |
| `<input type="range">` | <input type="range"> | スライダー |
| `<input type="number">` | <input type="number"> | 数値入力欄 |

---

### `<input>` から入力値を取得する
`<input>` タグに入力された値は JS から取得することができる。
ただし多くの場合、一つのページ内には*複数*の `<input>` タグが必要になる。
そのため、実運用においては個々の `<input>` タグに**識別子**をつける必要に迫られる。

HTML タグに識別子を与えるには、次のように **`id`** 属性を用いる。

```html
<div id="任意の識別子">
```

`id` 属性はどんなタグにも付与することのできる汎用属性の一つだ。

---

実際に URL 入力欄を作成してみよう。

`📁 qrgen` 内の `index.html` をエディタで開き、`<body>` 内に以下のように書き加えてほしい。

```html
<body>
  URL <input id="url" type="text">
  <script src="sketch.js"></script>
</body>
```

追加したのは `type="text"` の `<input>` タグで、識別子は `"url"` とした。

ちなみに入力欄の長さは *`size` 属性*で指定することができる。

```html
<input type="text" size="40"> <!-- 約 40 文字分 -->
```

---

次に、スケッチから URL 入力欄の値を取得してみよう。
手順は以下のようになる。

1. `select('#識別子')` で **`<input>` オブジェクト**を取得。
2. 取得した `<input>` オブジェクトの **`.value()` 関数**を呼ぶ。

---

実際のコードに落とし込むとこうなる。

```js
let input; // <input> オブジェクトを格納する変数

function setup() {
  createCanvas(400, 400);
  input = select('#url'); // 識別子が url の <input> オブジェクトを取得
}

function draw() {
  let url = input.value(); // 入力欄の値 (文字列) を取得
}
```

`.value()` 関数は *`オブジェクト変数名.value()`* と書かなければならない点に注意。
これは `.value()` が**そのオブジェクトに属する関数**だからだ。
オブジェクトに属する関数のことを「**メソッド**」と呼び、通常の関数と区別することがある。

